import { getPackageNameFromFilePath, getPackageNameFromModuleSpecifier } from '../util/modules.js';
import { isAbsolute, isInNodeModules, join } from '../util/path.js';
import { toBinary } from '../util/protocols.js';
import { _resolveSync } from '../util/resolve.js';
export const tryResolveFilePath = (cwd, specifier, acceptModuleSpecifier) => {
    if (specifier) {
        const filePath = isAbsolute(specifier) ? specifier : join(cwd, specifier);
        if (!isInNodeModules(filePath)) {
            const resolvedFilePath = _resolveSync(filePath, cwd);
            if (resolvedFilePath) {
                return resolvedFilePath;
            }
            if (acceptModuleSpecifier) {
                return getPackageNameFromModuleSpecifier(specifier);
            }
        }
        else if (specifier.includes('node_modules/.bin')) {
            return toBinary(trimBinary(specifier));
        }
        else {
            return getPackageNameFromFilePath(specifier);
        }
    }
};
export const tryResolveSpecifiers = (cwd, specifiers) => specifiers.map(specifier => tryResolveFilePath(cwd, specifier, true));
export const stripVersionFromSpecifier = (specifier) => specifier.replace(/(\S+)@.*/, '$1');
const stripNodeModulesFromPath = (command) => command.replace(/^(\.\/)?node_modules\//, '');
export const trimBinary = (command) => stripVersionFromSpecifier(stripNodeModulesFromPath(command)
    .replace(/^(\.bin\/)/, '')
    .replace(/\$\(npm bin\)\/(\w+)/, '$1'));
export const argsFrom = (args, from) => args.slice(args.indexOf(from));
